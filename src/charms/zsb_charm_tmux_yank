#!/usr/bin/env zsh
# set -o errexit
# set -o pipefail
set -o nounset

# (tightly coupled with tmux config and nvim)
# for tmux conf, see https://github.com/EdgardoArriagada/dotFiles/blob/main/tmux/home/.tmux.conf

local selection=`< /dev/stdin`

if [[ -n "$selection" ]]; then
  zsb_clipcopy <<< "$selection"
  exit 0
fi


local temp_file=$(mktemp)
TRAPEXIT() { rm -f $temp_file }


local read_char_command="printf '(w/y/q)'; read -n 1 char; printf \$char > $temp_file"
tmux popup -E -h3 -w11 -x0 -y100% "$read_char_command"

local char=$(< $temp_file)

case $char in
  "w")
    tmux send -X select-word \; send -X other-end \; send -X copy-selection
    ;;
  "y")
    tmux send -X copy-line
    ;;
  "q")
    exit 0
    ;;
  *)
    exit 1
    ;;
esac

exit 0
